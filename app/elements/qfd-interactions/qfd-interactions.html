<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="qfd-interactions">
  <template>
    <link rel="stylesheet" href="qfd-interactions.css">
    <template repeat="{{o, a in requirements}}">
        <template repeat="{{i, b in interactions | ofPivot(o)}}">
          <template bind="{{p in i | getPosition(a, b)}}">

            <diamond-button style="top:{{p.y}}px;left:{{p.x}}px;position:absolute;" size="{{size}}"></diamond-button>
<!--            <div style="width:40px;height:40px;top:{{p.y}}px;left:{{p.x}}px;position:absolute;background:red;text-align:center;line-height:40px;vergical-align:center;">{{i.pivot.a.id}}{{i.pivot.b.id}}</div>-->
         </template>
      </template>
    </template>
  </template>
  <script>
    (function () {
      'use strict';

      Polymer({
        interactions: [],
        requirements:[],
        size:40,
        log: function(d){
          console.log(d, '{{log}}')
        },
        observe:{
          requirements:'processInteractions'
        },
        ofPivot: function (collection, pivot) {
          return collection.filter(function (i) {
            if (i.pivot.a == pivot) {
              return i;
            }
          });
        },
        getPosition: function(item, ix, iy){
          var size = this.size;
          //var index = ths.interactions.indexOf(item) % this.requirements.length;
          var total = this.requirements.length;
          console.log(iy, 'iy')
          var pivot = {
            x: ix * (size) + iy * (size/2),
            y: (total/2) * size - iy * (size/2)
          };
          console.log(pivot, item.pivot.a.id, item.pivot.b.id);
          return pivot;
        },
        ready:function(){
          this.processInteractions();
        },
        processInteractions: function(){
          if(this.requirements<2){
            return;
          }
          var intermediary = this.requirements.slice(0);
          var that = this;
          this.interactions = [];

          function iterate(list){
            var i = list.shift();
            list.filter(function(j){
              if(i!=j){
                return j;
              }
            }).forEach(function(j, n){
              that.interactions.push(new that.Interaction(i, j));
            });

            if(list.length!=1){
                iterate(list);
            }
          }
          iterate(intermediary);
          console.log(this.interactions)
        },
        Interaction: function (a, b) {
          this.pivot = {
            a: a,
            b: b
          };
        }
      });

    })();
  </script>
</polymer-element>
