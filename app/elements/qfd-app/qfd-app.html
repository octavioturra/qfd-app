<link rel="import" href="../../bower_components/polymer/polymer.html">

<polymer-element name="qfd-app" attributes="">
  <template>
    <link rel="stylesheet" href="qfd-app.css">

    <header>
      <div id="requirementControls">
        <half-box id="halfBox" header="Customer Requirements" footer="Product Requirements" headerIcon="add"></half-box>
      </div>
      <div id="customerRequirements">
        <qfd-interactions id="interactions"></qfd-interactions>
        <template repeat="{{customerRequirements}}">
          <div class="customerRequirement_container">
            <input-fit value="{{description}}" class="customerRequirement"></input-fit>
          </div>
        </template>
      </div>

    </header>
    <main>
      <aside id="requirements">
        <template repeat="{{productRequirements}}">
          <input-fit value="{{description}}" class="productRequirement"></input-fit>
        </template>
      </aside>
      <div id="content" style="width:{{customerRequirements.length*40+2}}px;height:{{productRequirements.length*40}}px">
        <button-grid size="40" id="grid"></button-grid>
      </div>
      <aside id="requirementsEvaluation">
        <template repeat="{{productRequirements}}">
           <div class="requirementsEvaluation_container">
              <double-range valueA="{{relevance.inner}}" valueB="{{relevance.concurrent}}"></double-range>
           </div>
        </template>
      </aside>
    </main>

    <footer></footer>


  </template>
  <script src="../../bower_components/underscore/underscore.js"></script>
  <script>
    (function () {
      'use strict';

      Polymer({
        productRequirements: [{
          id: 1,
          description: 'teste',
          relevance:{}
        }, {
          id: 2,
          description: 'teste1',
          relevance:{}
        }, {
          id: 3,
          description: 'teste2',
          relevance:{}
        }, {
          id: 4,
          description: 'teste3',
          relevance:{}
        }],
        customerRequirements: [{
          id: 1,
          description: 'teste',
          relevance:{}
        }, {
          id: 2,
          description: 'teste1',
          relevance:{}
        }, {
          id: 3,
          description: 'teste2',
          relevance:{}
        }, {
          id: 4,
          description: 'teste3',
          relevance:{}
        }],
        ready: function () {
          var that = this;
          this.$.interactions.requirements = this.customerRequirements;
          this.$.interactions.requirementAction = function(r){that.removeCustomerRequirement(r)};
          var that = this;
          this.$.halfBox.headerAction = function(){that.addCustomerRequirement()};
          this.prepareGrid();
        },
        prepareGrid: function(){
          var grid = [];
          
          _(this.productRequirements).each(function(pr){
            var row = [];
            _(this.cutomerRequirements).each(function(cr){
              row.push({
                x:pr,
                y:cr
              });
            });
            grid.push(row);
          });
          this.$.grid.grid = grid;
        },
        addCustomerRequirement: function () {
          var last = this.customerRequirements[this.customerRequirements.length - 1];
          this.customerRequirements.push({
            id: last.id + 1
          });
        },
        removeCustomerRequirement: function (r) {
          this.customerRequirements = _(this.customerRequirements).without(r);
          this.$.interactions.requirements = this.customerRequirements;
        }
      });

    })();
  </script>
</polymer-element>
